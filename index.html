

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LibTSMReactive &mdash; LibTSMReactive  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/lua.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="API/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            LibTSMReactive
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="API/index.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">LibTSMReactive</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LibTSMReactive</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="libtsmreactive">
<h1>LibTSMReactive<a class="headerlink" href="#libtsmreactive" title="Link to this heading"></a></h1>
<p>The Reactive framework is based around observable state objects. One of the primary goals of
the Reactive framework is make it easy to build state-driven UI, where the UI can respond to
specific state fields being updated without needing to completely rerender the entire UI. For
example, if we have a UI that displays the player’s current amount of gold among other player
statistics, we only need to update the player gold text content when that value changes,
rather than redrawing the entire window.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading"></a></h2>
<p>This library has the following external dependencies which must be installed separately within the
target application:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMClass">LibTSMClass</a></p></li>
<li><p><a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMCore">LibTSMCore</a></p></li>
<li><p><a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMUtil">LibTSMUtil</a></p></li>
</ul>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>If you’re using the <a class="reference external" href="https://github.com/BigWigsMods/packager">BigWigs packager</a>, you can reference LibTSMReactive as an external library.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">externals</span><span class="p">:</span>
<span class="w">   </span><span class="nt">Libs/LibTSMReactive</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/TradeSkillMaster/LibTSMReactive.git</span>
</pre></div>
</div>
<p>Otherwise, you can download the <a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMReactive/releases">latest release directly from GitHub</a>.</p>
</section>
<section id="overview-by-example">
<h2>Overview by Example<a class="headerlink" href="#overview-by-example" title="Link to this heading"></a></h2>
<p>Below is an overview of all the major components of the Reactive framework provided by
LibTSMReactive. They are all presented via an example of a button which updates its text to be a
count of the number of times it has been clicked.</p>
<p>We’ll start by initializing our <a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMCore">LibTSMCore</a> module, pulling in the LibTSMReactive modules and
classes we’ll need, and creating a local <code class="docutils literal notranslate"><span class="pre">private</span></code> table to store any file-scoped variables and
functions.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- ClickCounter.lua</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">MyUIModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">select</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">...).</span><span class="nv">MyUIModule</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">ClickCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyUIModule</span><span class="p">:</span><span class="nf">Init</span><span class="p">(</span><span class="s2">&quot;ClickCounter&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">Reactive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyUIModule</span><span class="p">:</span><span class="nf">From</span><span class="p">(</span><span class="s2">&quot;LibTSMReactive&quot;</span><span class="p">):</span><span class="nf">Include</span><span class="p">(</span><span class="s2">&quot;Reactive&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">UIManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyUIModule</span><span class="p">:</span><span class="nf">From</span><span class="p">(</span><span class="s2">&quot;LibTSMReactive&quot;</span><span class="p">):</span><span class="nf">Include</span><span class="p">(</span><span class="s2">&quot;UIManager&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</pre></div>
</div>
<section id="state">
<h3>State<a class="headerlink" href="#state" title="Link to this heading"></a></h3>
<p>The state object is a strongly-typed representation of all the state which is driving a given
component. The schema of the state is first defined via a
<a class="reference internal" href="API/state_schema.html"><span class="doc">ReactiveStateSchema</span></a> object.</p>
<p>For the purposes of our example, we just need a single state field to track the number of times the
button has been clicked. This generally gets defined at the top of the module and is local to the
file.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span><span class="w"> </span><span class="nv">STATE_SCHEMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Reactive</span><span class="p">.</span><span class="nf">CreateStateSchema</span><span class="p">(</span><span class="s2">&quot;CLICK_COUNTER_UI_STATE&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">:</span><span class="nf">AddNumberField</span><span class="p">(</span><span class="s2">&quot;numClicks&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">   </span><span class="p">:</span><span class="nf">Commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Now that we have the state schema, we can create a state object from it. This state object is
strongly-typed with the fields and default values defined by the schema. The state object typically
is created on module load.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="nv">ClickCounter</span><span class="p">:</span><span class="nf">OnModuleLoad</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
<span class="w">   </span><span class="kd">local</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">STATE_SCHEMA</span><span class="p">:</span><span class="nf">CreateState</span><span class="p">()</span>
<span class="w">   </span><span class="nb">print</span><span class="p">(</span><span class="nv">state</span><span class="p">.</span><span class="py">numClicks</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 0</span>

<span class="w">   </span><span class="c1">-- ...</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ui-manager">
<h3>UI Manager<a class="headerlink" href="#ui-manager" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="API/ui_manager.html"><span class="doc">UIManager</span></a> class provides a framework for managing the state which
drives a given UI and respond to actions which mutate the state. As a general convention, the state
object should not be stored by the module, but rather owned by the UIManager object and only
accessed via methods and callbacks on the UIManager object.</p>
<p>Going back to our example, the following code will get added to our module load function.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="nv">private</span><span class="p">.</span><span class="py">manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">UIManager</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;CLICK_COUNTER&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">private</span><span class="p">.</span><span class="py">ActionHandler</span><span class="p">)</span>
<span class="w">   </span><span class="p">:</span><span class="nf">AddFrameBuilder</span><span class="p">(</span><span class="nv">private</span><span class="p">.</span><span class="py">CreateFrame</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this references two functions we haven’t defined yet. The first is the action handler
which is responsible for responding to actions in order to mutate the state. In this case, we have
a single action we want to respond to, which is the button being clicked.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">---</span><span class="k k-Comment">@param</span><span class="cm"> manager UIManager</span>
<span class="cm">---</span><span class="k k-Comment">@param</span><span class="cm"> state ClickCounterUIState</span>
<span class="kr">function</span><span class="w"> </span><span class="nc">private</span><span class="p">.</span><span class="nf">ActionHandler</span><span class="p">(</span><span class="nv">manager</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">action</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="w">   </span><span class="kr">if</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;ACTION_HANDLE_CLICK&quot;</span><span class="w"> </span><span class="kr">then</span>
<span class="w">      </span><span class="nv">state</span><span class="p">.</span><span class="py">numClicks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">state</span><span class="p">.</span><span class="py">numClicks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="kr">else</span>
<span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="s2">&quot;Unknown action: &quot;</span><span class="o">..</span><span class="nb">tostring</span><span class="p">(</span><span class="nv">action</span><span class="p">))</span>
<span class="w">   </span><span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>The other function we need to define is the one which actually creates our UI frame. For the
purpose of this example, we’ll simply create a button in the middle of the screen and trigger the
action when it’s clicked.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">---</span><span class="k k-Comment">@param</span><span class="cm"> state ClickCounterUIState</span>
<span class="kr">function</span><span class="w"> </span><span class="nc">private</span><span class="p">.</span><span class="nf">CreateFrame</span><span class="p">(</span><span class="nv">state</span><span class="p">)</span>
<span class="w">   </span><span class="kd">local</span><span class="w"> </span><span class="nv">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CreateFrame</span><span class="p">(</span><span class="s2">&quot;Button&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nv">UIParent</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UIPanelButtonTemplate&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nv">button</span><span class="p">:</span><span class="nf">SetPoint</span><span class="p">(</span><span class="s2">&quot;CENTER&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nv">button</span><span class="p">:</span><span class="nf">SetWidth</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
<span class="w">   </span><span class="nv">button</span><span class="p">:</span><span class="nf">SetHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="w">   </span><span class="nv">button</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="s2">&quot;%d clicks&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">state</span><span class="p">.</span><span class="py">numClicks</span><span class="p">))</span>
<span class="w">   </span><span class="nv">button</span><span class="p">:</span><span class="nf">SetScript</span><span class="p">(</span><span class="s2">&quot;OnClick&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">private</span><span class="p">.</span><span class="py">manager</span><span class="p">:</span><span class="nf">CallbackToProcessAction</span><span class="p">(</span><span class="s2">&quot;ACTION_HANDLE_CLICK&quot;</span><span class="p">))</span>
<span class="w">   </span><span class="c1">-- To be continued...</span>
<span class="kr">end</span>
</pre></div>
</div>
</section>
<section id="publishers">
<h3>Publishers<a class="headerlink" href="#publishers" title="Link to this heading"></a></h3>
<p>Publishers are used to subscribe to state changes and define the logic that should be run in
reaction to state changes. They can be used to define fairly complex data pipelines and are the
crux of what makes the Reactive framework so powerful.</p>
<p>For the purposes of our example, we want to set the text of the button based on the <code class="docutils literal notranslate"><span class="pre">numClicks</span></code>
state property. We also want to map it to a formatted string to make it more useful to the user.
This can be accomplished with the following publisher definition, added to the end of the
<code class="docutils literal notranslate"><span class="pre">private.CreateFrame(state)</span></code> function.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="nv">private</span><span class="p">.</span><span class="py">manager</span><span class="p">:</span><span class="nf">AddCancellable</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span><span class="nf">Publisher</span><span class="p">(</span><span class="s2">&quot;numClicks&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">:</span><span class="nf">ToStringFormat</span><span class="p">(</span><span class="s2">&quot;%d clicks&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">:</span><span class="nf">CallMethod</span><span class="p">(</span><span class="nv">button</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SetText&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There are a few things going on here which are worth walking through:</p>
<ol class="arabic simple">
<li><p>We’re creating a publisher which will handle changes to the <code class="docutils literal notranslate"><span class="pre">numClicks</span></code> state property.</p></li>
<li><p>The following steps of the publisher will receive the new <code class="docutils literal notranslate"><span class="pre">numClicks</span></code> values. In this case,
the next step is mapping the published values with a format string of “%d clicks”. This
transforms the data value being handled, such that following steps now receive a
“### clicks” string (with the actual value inserted for ‘###’).</p></li>
<li><p>Lastly, the publisher chain is consuming the published value by calling the <code class="docutils literal notranslate"><span class="pre">:SetText()</span></code>
method on our button with the published values.</p></li>
<li><p>The result of calling a publisher method which consumes the value (i.e. <code class="docutils literal notranslate"><span class="pre">CallMethod()</span></code>) is
that the publisher is committed. Under the hood, whats happening is that all the previous steps
were operating on a <code class="docutils literal notranslate"><span class="pre">ReactivePublisherSchema</span></code> object, and once that’s committed, a
<code class="docutils literal notranslate"><span class="pre">ReactivePublisher</span></code> object is returned.</p></li>
<li><p>This <code class="docutils literal notranslate"><span class="pre">ReactivePublisher</span></code> object is referred to by the Reactive framework as a “cancellable”
because it can be used to cancel the publisher change for lifecycle purposes. We’re passing this
cancellable to our UIManager as a way of assigning the lifecycle of the publisher to the
UIManager. Internally, the UIManager is calling the <code class="docutils literal notranslate"><span class="pre">:Stored()</span></code> method of the publisher, which
is what finally triggers the publisher to start subscribing to state updates and handling
values. In this case, it will also immediately process the initial value of the <code class="docutils literal notranslate"><span class="pre">numClicks</span></code>
property, which is handy so that we don’t need to explicitly set the initial text value of our
button.</p></li>
</ol>
<p>For the full set of methods available for defining publisher steps, see the
<a class="reference internal" href="API/publisher_schema.html"><span class="doc">ReactivePublisherSchema</span></a> API documentation. Similarly, there are many
ways to create a publisher from a state object, which are covered in the
<a class="reference internal" href="API/state.html"><span class="doc">ReactiveState</span></a> documentation.</p>
</section>
</section>
<section id="license-and-contributions">
<h2>License and Contributions<a class="headerlink" href="#license-and-contributions" title="Link to this heading"></a></h2>
<p>LibTSMReactive is licensed under the MIT license. See LICENSE.txt for more information. If you
would like to contribute to LibTSMReactive, opening an issue or submitting a pull request against
the <a class="reference external" href="https://github.com/TradeSkillMaster/LibTSMReactive">LibTSMReactive GitHub project</a> is highly encouraged.</p>
<div class="toctree-wrapper compound">
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="API/index.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, TradeSkillMaster LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>